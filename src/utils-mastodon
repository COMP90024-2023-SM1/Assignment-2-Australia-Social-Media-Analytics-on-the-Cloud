import websocket
import requests
import json

# Replace [mastodon-instance] with the hostname of your Mastodon instance
stream_url = "wss://techhub.social/api/v1/streaming/?stream=public"

# Replace [access-token] with your Mastodon access token
headers = {
    "Authorization": "Bearer H5j7Ph4s8D79YfWE1BKgrxaLJeYsLWgvTjHIeAMG1gc"
}

# Open a WebSocket connection to the streaming endpoint
ws = websocket.create_connection(stream_url, header=headers)

# Loop indefinitely, processing incoming messages from the WebSocket
while True:
    message = ws.recv()
    if message:
        # Decode the message as JSON
        data = json.loads(message)
        event = data['event']
        payload = json.loads(data['payload'])
        if event == 'update' and payload['language'] == 'en' and payload.get('tags'):
            print([tag['name'] for tag in payload['tags']])